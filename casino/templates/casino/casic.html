<!DOCTYPE html>
<html lang="uk">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>–ü—Å–µ–≤–¥–æ –ö–∞–∑–∏–Ω–æ üé∞</title>
    <link rel="stylesheet" href="{% static 'casino/css/styles_casic.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="casino-container">
    <h1>üé∞ Fav ZUNU</h1>
    <input type="text" id="user_name" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è">

    <div class="slot-grid">
        {% for i in "123456789" %}
        <img id="slot{{i}}" src="{% static 'casino/img/spintal.png' %}" class="slot-img">
        {% endfor %}
    </div>

    <button id="spinBtn">–ö—Ä—É—Ç–∏—Ç–∏ —Å–ª–æ—Ç!</button>
    <p id="outcome"></p>
</div>

<script>
const images = {
    "spintal": "{% static 'casino/img/spintal.png' %}",
    "barranic": "{% static 'casino/img/barranic.png' %}",
    "vozniak": "{% static 'casino/img/vozniak.png' %}",
    "dekan": "{% static 'casino/img/dekan.png' %}",
    "kyrator": "{% static 'casino/img/kyrator.png' %}"
};

function getRandomSymbol() {
    const keys = Object.keys(images);
    return keys[Math.floor(Math.random() * keys.length)];
}

function spinAnimation(callback) {
    const slots = 9;
    let spins = 0;

    const interval = setInterval(() => {
        for(let i=1; i<=slots; i++){
            $('#slot'+i).attr('src', images[getRandomSymbol()]);
        }
        spins++;
        if(spins >= 20) { // –∫—ñ–ª—å–∫—ñ—Å—Ç—å —à–≤–∏–¥–∫–∏—Ö ‚Äú–∫—Ä—É—Ç—ñ–Ω—å‚Äù
            clearInterval(interval);
            callback();
        }
    }, 100); // —à–≤–∏–¥–∫—ñ—Å—Ç—å –∫—Ä—É—á–µ–Ω–Ω—è
}

$('#spinBtn').click(function(){
    let user_name = $('#user_name').val() || "–ì—Ä–∞–≤–µ—Ü—å";

    spinAnimation(() => {
        $.ajax({
            type: "POST",
            url: "{% url 'spin' %}",
            data: {
                'user_name': user_name,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(data){
                // –∑–∞–ø–æ–≤–Ω—é—î–º–æ 3x3 –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                const slot_values = data.slot; // –æ—á—ñ–∫—É—î–º–æ 9 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
                for(let i=1;i<=9;i++){
                    $('#slot'+i).attr('src', images[slot_values[i-1]]);
                }
                $('#outcome').text(data.outcome);
            }
        });
    });
});
</script>
</body>
</html>
